package id3;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.io.Writer;

public class GraphPrinter {
	
	private String graphvizLocation;
	private String imageType;
	private String outputFolder;
	
	public GraphPrinter(String graphvizLocation, String imageType, String outputFolder) throws Exception{
		if (new File(graphvizLocation,"dot.exe").exists()){
			this.graphvizLocation = graphvizLocation;
			this.imageType = imageType;
			this.outputFolder = outputFolder;
		} else throw new Exception("No GraphViz available.");
	}
	
	/**
     * dot-Datei anlegen und mit Daten fuellen.
     *  
     * @param	file	Dateiname
	 * @throws IOException 
     */
	public void createAutomatGraphViz(String file, Node decisionTree) throws IOException{

		Writer output = new BufferedWriter(new FileWriter(outputFolder+"\\"+file+".dot"));  
        output.write(createStringGraphViz(decisionTree));  
        output.flush();
        output.close();  
		
        System.out.println(graphvizLocation + " -T" + imageType + " \"" + outputFolder +"\\" + file + ".dot\" -o \""+ outputFolder + "\\" + file+"." + imageType + "\"");
        Runtime.getRuntime().exec(graphvizLocation + " -T" + imageType + " \"" + outputFolder +"\\" + file + ".dot\" -o \""+ outputFolder + "\\" + file+"." + imageType + "\"");
	}

	/**
     * Daten in GraphViz-String-Format konvertieren
     *  
     * @return	Daten im GraphViz-String-Format
     */
	private String createStringGraphViz(Node decisionTree){
		
		//Ausrichtung von links nach rechts
		String result = "digraph G {\n";
		
		//unsichtbarer Knoten 0 der auf Startstate zeigt (fuer eingehenden Pfeil)
		
		result += "node0 [style=invis]\nnode0 -> \""+decisionTree.getClassification()+"\" [label=\"\"]\n";
		result += decisionTree.transistionsToStringGraphViz();

		result = result+"}";
		
		return result;	
	}

}
